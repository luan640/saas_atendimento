{# appointments/partials/confirmacao.html #}
<div id="step-confirmacao" class="my-3">
  <div class="card border-0 shadow-sm">
    <div class="card-body p-4 p-md-5 text-center">

      <div class="mb-3">
        <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-success-subtle text-success"
             style="width:64px;height:64px;">
          <i class="bi bi-check2-circle fs-1"></i>
        </div>
      </div>

      <h3 class="mb-1">Agendamento confirmado!</h3>
      <p class="text-muted mb-4">Enviamos os detalhes abaixo. Guarde para consultar depois.</p>

      {# Resumo em grade #}
      <div class="row g-3 text-start justify-content-center mb-3">
        <div class="col-12 col-md-10 col-lg-8">
          <div class="list-group list-group-flush">
            <div class="list-group-item px-0 d-flex">
              <div class="me-2 text-muted" style="width:140px;">Profissional</div>
              <div class="fw-semibold">{{ agendamento.funcionario.nome }}</div>
            </div>
            <div class="list-group-item px-0 d-flex">
              <div class="me-2 text-muted" style="width:140px;">Serviços</div>
              <div>
                {% for s in agendamento.servicos.all %}
                  {{ s.nome }}{% if not forloop.last %}, {% endif %}
                {% empty %}—{% endfor %}
              </div>
            </div>
            <div class="list-group-item px-0 d-flex">
              <div class="me-2 text-muted" style="width:140px;">Data</div>
              <div>{{ agendamento.data|date:"d/m/Y" }}</div>
            </div>
            <div class="list-group-item px-0 d-flex">
              <div class="me-2 text-muted" style="width:140px;">Hora</div>
              <div>{{ agendamento.hora|time:"H:i" }}</div>
            </div>
            {% if agendamento.loja %}
            <div class="list-group-item px-0 d-flex">
              <div class="me-2 text-muted" style="width:140px;">Loja</div>
              <div>{{ agendamento.loja.nome }}{% if agendamento.loja.endereco %} — <span class="text-muted">{{ agendamento.loja.endereco }}</span>{% endif %}</div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      {# Ações principais #}
      <div class="d-flex flex-wrap gap-2 justify-content-center">
        <a class="btn btn-success" href="{% url 'accounts:client_dashboard' %}">
          <i class="bi bi-person-check me-1"></i> Ver meus agendamentos
        </a>
        <button class="btn btn-outline-secondary" type="button" onclick="window.print()">
          <i class="bi bi-printer me-1"></i> Imprimir
        </button>

        {# Compartilhar por WhatsApp #}
        {% with data_txt=agendamento.data|date:"d/m/Y"|add:" às "|add:agendamento.hora|time:"H:i" loja_nome=agendamento.loja.nome|default:"sua barbearia" servicos_txt=agendamento.servicos.all|join:", " %}
        {% with base_text='Agendamento confirmado em '|add:loja_nome|add:' – '|add:data_txt|add:' com '|add:agendamento.funcionario.nome %}
            {% if servicos_txt %}
                {% with share_text=base_text|add:'. Serviços: '|add:servicos_txt %}
                    <a class="btn btn-outline-success"
                    href="https://wa.me/?text={{ share_text|urlencode }}"
                    target="_blank" rel="noopener">
                    <i class="bi bi-whatsapp me-1"></i> Enviar no WhatsApp
                    </a>
                {% endwith %}
                {% else %}
                {% with share_text=base_text|add:'.' %}
                    <a class="btn btn-outline-success"
                    href="https://wa.me/?text={{ share_text|urlencode }}"
                    target="_blank" rel="noopener">
                    <i class="bi bi-whatsapp me-1"></i> Enviar no WhatsApp
                    </a>
                {% endwith %}
            {% endif %}
        {% endwith %}
        {% endwith %}
      </div>

      <div class="text-muted small mt-3">
        Se precisar alterar ou cancelar, faça isso pela sua Área do Cliente.
      </div>
    </div>
  </div>
</div>
