{# accounts/partials/client_dashboard.html #}
<div class="card card-elev mb-3">
  <div class="card-body">
    <div class="d-flex align-items-center justify-content-between mb-2">
      <h5 class="mb-0"><i class="bi bi-calendar-event me-1"></i> Seus agendamentos</h5>
    </div>

    {% if agendamentos %}
      <div class="list-group list-group-flush">
        {% for a in agendamentos %}
          <div class="list-group-item px-0">
            <div class="d-flex flex-wrap align-items-center gap-3">
              <div class="d-flex align-items-center me-auto">
                <div class="me-3 text-center">
                  <div class="fw-bold">{{ a.data|date:"d" }}</div>
                  <div class="text-muted small text-uppercase">{{ a.data|date:"b" }}</div>
                </div>
                <div>
                  <div class="fw-semibold">
                    {{ a.data|date:"D" }}, {{ a.data|date:"d/m/Y" }} às {{ a.hora|time:"H:i" }}
                    {% if a.duracao_minutos %}<span class="text-muted">• {{ a.duracao_minutos }} min</span>{% endif %}
                  </div>
                  <div class="text-muted small">
                    Serviços:
                    {% if a.servicos.all %}
                      {% for s in a.servicos.all %}
                        {{ s.nome }}{% if not forloop.last %}, {% endif %}
                      {% endfor %}
                    {% else %}—{% endif %}
                    {% if a.funcionario %}
                      — Funcionário: {{ a.funcionario.nome|default:"—" }}
                    {% endif %}
                  </div>
                  {% if a.observacoes %}
                    <div class="small mt-1"><i class="bi bi-chat-square-text"></i> {{ a.observacoes }}</div>
                  {% endif %}
                </div>
              </div>

              {# status #}
              {% with st=a.status|default:"confirmado" %}
              <span class="badge 
                {% if st == 'confirmado' %} text-bg-success
                {% elif st == 'pendente' %} text-bg-warning
                {% elif st == 'cancelado' %} text-bg-secondary
                {% else %} text-bg-light border
                {% endif %}">
                {{ st|capfirst }}
              </span>
              {% endwith %}

              {# ações (opcionais; só mostra se tiver URLs no objeto) #}
              <div class="d-flex align-items-center gap-2">
                {% if a.reagendar_url %}
                  <a href="{{ a.reagendar_url }}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-arrow-repeat"></i> Reagendar
                  </a>
                {% endif %}
                {% if a.cancel_url %}
                  <button class="btn btn-sm btn-outline-danger"
                          hx-post="{{ a.cancel_url }}"
                          hx-headers='{"X-CSRFToken":"{{ csrf_token }}"}'
                          hx-target="#client-dashboard-fragment"
                          hx-swap="outerHTML"
                          hx-confirm="Tem certeza que deseja cancelar este agendamento?"
                          hx-disabled-elt="this">
                    <i class="bi bi-x-circle"></i> Cancelar
                  </button>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-4">
        <div class="mb-2"><i class="bi bi-emoji-smile fs-1 text-muted"></i></div>
        <div class="fw-semibold">Você ainda não tem agendamentos.</div>
        <div class="text-muted mb-3">Que tal marcar um horário agora?</div>
        <a href="{% url 'appointments:agendamento_start' %}" class="btn btn-primary">
          <i class="bi bi-calendar-plus me-1"></i> Agendar
        </a>
      </div>
    {% endif %}
  </div>
</div>
