<div class="modal-header">
  <h5 class="modal-title">Criar atendimento</h5>
  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
  <form id="formCriarAtendimento"
        hx-post="{% url 'accounts:owner_criar_atendimento' %}"
        hx-target="#agendamentos-section"
        hx-select="#agendamentos-section"
        hx-swap="outerHTML"
        hx-indicator="#dash-loading"
         hx-on="htmx:afterRequest: if (event.target.id === 'formCriarAtendimento' && event.detail.xhr.status < 400) { try { bootstrap.Modal.getOrCreateInstance(document.getElementById('modalShellLarge')).hide(); } catch(e) {} }">
    {% csrf_token %}
    <div class="mb-3">
      <label for="cliente" class="form-label">Cliente</label>
      <div class="input-group">
        <select class="form-select" id="cliente" name="cliente">
          {% for c in clientes %}
            <option value="{{ c.user.id }}">{{ c.user.full_name }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="mb-3">
      <label for="loja" class="form-label">Loja</label>
      <select class="form-select" id="loja" name="loja"
              hx-get="{% url 'accounts:owner_atendimento_loja' %}"
              hx-trigger="change"
              hx-target="#loja-fields"
              hx-swap="innerHTML">
        {% for l in lojas %}
          <option value="{{ l.id }}"{% if loja and loja.id == l.id %} selected{% endif %}>{{ l.nome }}</option>
        {% endfor %}
      </select>
    </div>

    <div id="loja-fields">
      {% include 'accounts/partials/criar_atendimento_loja_fields.html' %}
    </div>
  </form>
</div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
    <button type="submit" class="btn btn-primary" form="formCriarAtendimento">Salvar</button>
  </div>
